app.controller("InvoicesListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,o,t,i,n,r){e.exception={},e.resources={},e.resources.invoiceListUrl=r.buildUrl("/customers/me/invoices")}]),app.controller("InvoicesSetCtrl",["$scope","$routeParams","$location","ApiService","SettingsService","ConfirmService","GrowlsService",function(e,o,t,i,n,r,c){e.invoice={},e.payment={},e.exception={},e.count={},e.count.payments=0,e.count.refunds=0,e.resources={},e.currencies=n.get().account.currencies,e.params={expand:"customer.payment_methods,options,payments.payment_method,items.subscription_terms,subscription",formatted:!0},e.url=i.buildUrl("/invoices/"+o.id),e.resources.paymentListUrl=e.url+"/payments",e.resources.refundListUrl=e.url+"/refunds",i.getItem(e.url,e.params).then(function(o){e.invoice=o,e.successful_payment=_.findWhere(e.invoice.payments.data,{success:!0})},function(o){e.exception.error=o,window.scrollTo(0,0)}),e.send=function(){i.set(null,e.url+"/send").then(function(o){c.addGrowl({id:"invoice_sent",type:"success",email:e.invoice.customer.email})},function(o){e.exception.error=o,window.scrollTo(0,0)})},e.downloadPdf=function(){i.getItemPdf(e.url).then(function(o){var t=new Blob([o],{type:"application/pdf"});saveAs(t,"Invoice_"+e.invoice.invoice_id+".pdf")},function(o){e.exception.error=o,window.scrollTo(0,0)})},e.changeCurrency=function(){var o={currency:e.invoice.currency};return i.set(o,e.url,e.params).then(function(o){e.invoice=o},function(o){e.exception.error=o,window.scrollTo(0,0)})}}]),app.controller("NotificationsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,o,t,i,n,r){e.exception={},e.resources={},e.resources.notificationListUrl=r.buildUrl("/notifications")}]),app.controller("NotificationsViewCtrl",["$scope","$routeParams","ApiService","GrowlsService","$sce",function(e,o,t,i,n){e.notification={},e.exception={},e.url=t.buildUrl("/notifications/"+o.id),e.previewUrl=null,e.showResend=!1;var r={expand:"customer",hide:"data"};t.getItem(e.url,r).then(function(o){e.notification=o,e.previewUrl=n.trustAsResourceUrl("/app/pages/notifications/preview/index.html?notification_id="+o.notification_id),e.email=o.customer.email},function(o){e.exception.error=o,window.scrollTo(0,0)}),e.resend=function(o){if(!o.$invalid){var n={destination:e.email};t.set(n,e.url+"/resend",{show:"notification_id"}).then(function(o){i.addGrowl({id:"notification_resend",email:e.email,type:"success"}),e.showResend=!1},function(o){e.exception.error=o,window.scrollTo(0,0)})}}}]),app.controller("NotificationsPreviewCtrl",["$scope","$routeParams","ApiService",function(e,o,t){e.notification={},e.exception={},e.url=t.buildUrl("/notifications/"+o.id);var i={show:"body"};t.getItem(e.url,i).then(function(o){e.notification=o},function(o){e.exception.error=o,window.scrollTo(0,0)})}]),app.controller("OrdersListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,o,t,i,n,r){e.exception={},e.resources={},e.resources.orderListUrl=r.buildUrl("/customers/me/orders")}]),app.controller("OrdersViewCtrl",["$scope","$routeParams","ApiService","ConfirmService","GrowlsService",function(e,o,t,i,n){e.order={},e.payment={},e.exception={},e.count={},e.count.shipments=0,e.resources={},e.url=t.buildUrl("/orders/"+o.id),e.resources.shipmentListUrl=e.url+"/shipments",e.resources.refundListUrl=e.url+"/refunds",e.resources.notificationListUrl=e.url+"/notifications";var r={expand:"customer,payment.response_data,payment.payment_method,payment.gateway,payment.refunds,items.product,items.subscription,items.download.file,items.license.license_service,shipments",hide:"items.product.images,items.license.license_service.configuration",formatted:!0};t.getItem(e.url,r).then(function(o){e.order=o,e.showShipping=!1,_.each(e.order.items,function(o){o.license&&(o.license.renderedHtml="<strong>"+o.license.label+"</strong><br>"+o.license.html,o.license.instructions&&(e.renderedLicenseHtml+="<br><br>"+o.license.instructions)),"physical"==o.type&&(e.showShipping=!0)})},function(o){e.exception.error=o,window.scrollTo(0,0)}),e.downloadPdf=function(){t.getItemPdf(e.url).then(function(o){var t=new Blob([o],{type:"application/pdf"});saveAs(t,"Order_"+e.order.order_id+".pdf")},function(o){e.exception.error=o,window.scrollTo(0,0)})}}]),app.controller("PaymentMethodsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,o,t,i,n,r){e.exception={},e.resources={},e.resources.paymentMethodListUrl=r.buildUrl("/customers/me/payment_methods")}]),app.controller("PaymentMethodsSetCtrl",["$scope","$routeParams","$location","ApiService","SettingsService","ConfirmService","GrowlsService","GeographiesService",function(e,o,t,i,n,r,c,s){e.paymentMethod={data:{billing_address:{}}},e.countries={},e.exception={},e.update=!1,e.add=!0,e.params="",e.geo=s,e.countries=e.geo.getGeographies().countries,e.countries.push({code:"EU",name:"European Union"}),e.countries=_.sortBy(e.countries,"name"),o.id&&(e.url=i.buildUrl("/customers/me/payment_methods/"+o.id),e.add=!1,e.update=!0,i.getItem(e.url,e.params).then(function(o){e.paymentMethod=o},function(o){e.exception.error=o,window.scrollTo(0,0)})),e.addPaymentMethod=function(){return e.form.$invalid?void window.scrollTo(0,0):(e.paymentMethod.type="credit_card",e.paymentMethod.data.billing_address.country=e.paymentMethod.data.billing_address.country.code,void i.set(e.paymentMethod,i.buildUrl("/customers/me/payment_methods"),{show:"payment_method_id"}).then(function(e){c.addGrowl({id:"add_success",name:e.payment_method_id,type:"success",payment_method_id:e.payment_method_id,url:"#/payment_methods/"+e.payment_method_id+"/edit"}),window.location="#/payment_methods"},function(o){e.exception.error=o,window.scrollTo(0,0)}))},e.updatePaymentMethod=function(){return e.form.$invalid?void window.scrollTo(0,0):void i.set(e.paymentMethod,e.url,{show:"payment_method_id"}).then(function(e){c.addGrowl({id:"edit_success",name:e.payment_method_id,type:"success",payment_method_id:e.payment_method_id,url:"#/payment_methods/"+e.payment_method_id+"/edit"}),window.location="#/payment_methods"},function(o){window.scrollTo(0,0),e.exception.error=o})},e.confirmCancel=function(){var o={id:"changes_lost"};o.onConfirm=function(){utils.redirect(t,"/payment_methods")},r.showConfirm(e,o)},e.confirmDelete=function(){var o={id:"delete"};o.onConfirm=function(){e.removePaymentMethod()},r.showConfirm(e,o)},e.removePaymentMethod=function(){i.remove(e.paymentMethod.url).then(function(o){c.addGrowl({id:"delete_success",name:e.paymentMethod.payment_method_id,type:"success"}),utils.redirect(t,"/payment_methods")},function(o){window.scrollTo(0,0),e.exception.error=o})}}]),app.controller("CustomersViewCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","GeographiesService",function(e,o,t,i,n,r,c){e.customer={},e.billing_address={},e.shipping_address={},e.resources={},e.edit=!1,e.exception={},e.credentials={},e.url=n.buildUrl("/customers/me"),n.getItem(e.url).then(function(o){e.customer=o,e.credentials.username=o.username,e.payment_methods=o.payment_methods},function(o){e.exception.error=o,window.scrollTo(0,0)}),e.setCredentials=function(){e.exception.error=null,n.set(e.credentials,e.url).then(function(o){e.customer=o,i.addGrowl({id:"credentials_saved",type:"success"}),e.editCredentials=!1},function(o){e.exception.error=o,window.scrollTo(0,0)})}}]),app.controller("SubscriptionsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,o,t,i,n,r){e.exception={},e.resources={},e.resources.subscriptionListUrl=r.buildUrl("/customers/me/subscriptions")}]),app.controller("SubscriptionsViewCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","SettingsService",function(e,o,t,i,n,r,c){e.exception={},e.payment_method=null,e.invoices={},e.model={},e.model.subscription={},e.resources={},e.count={},e.count.invoices=0,e.allowCancel=c.get().account.allow_customer_subscription_cancel,e.url=n.buildUrl("/subscriptions/"+o.id),e.resources.invoiceListUrl=e.url+"/invoices",n.getItem(e.url,{expand:"subscription_plan,customer.payment_methods,item.product",hide:"product.images"}).then(function(o){e.model.subscription=o},function(o){e.exception.error=o,window.scrollTo(0,0)}),e.uncancel=function(){n.set(null,e.url+"/uncancel",{expand:"subscription_plan,customer.cards,product",hide:"product.images"}).then(function(o){e.model.subscription=o},function(o){e.exception.error=o,window.scrollTo(0,0)})}}]),$("document").ready(function(){var e=localStorage.getItem("token"),o="api.comecero.com";window.location.hostname.indexOf("admin-staging.")>-1&&(o="api-staging.comecero.com");var t=utils.getPageQueryParameters(),i="https://"+o+"/api/v1/invoices/"+t.invoice_id+"/links";t.invoice_id&&$.ajax({type:"POST",url:i,beforeSend:function(o){o.setRequestHeader("Authorization","Bearer "+e)},success:function(e){window.location=e.link_url}})}),$("document").ready(function(){var e=localStorage.getItem("token"),o="api.comecero.com";window.location.hostname.indexOf("admin-staging.")>-1&&(o="api-staging.comecero.com");var t=utils.getPageQueryParameters(),i="https://"+o+"/api/v1/notifications/"+t.notification_id+"?show=body";t.notification_id&&$.ajax({type:"GET",url:i,beforeSend:function(o){o.setRequestHeader("Authorization","Bearer "+e)},success:function(e){document.open(),document.write(e.body),document.close()}})});