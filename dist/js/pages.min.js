app.controller("InvoicesListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,i,o,n,r,t){e.exception={},e.resources={},e.resources.invoiceListUrl=t.buildUrl("/customers/me/invoices")}]),app.controller("InvoicesSetCtrl",["$scope","$routeParams","$location","ApiService","SettingsService","ConfirmService","GrowlsService",function(e,i,o,n,r,t,c){e.invoice={},e.payment={},e.exception={},e.count={},e.count.payments=0,e.count.refunds=0,e.resources={},e.currencies=r.get().account.currencies,e.params={expand:"customer.payment_methods,options,payments.payment_method,items.subscription_terms,subscription",formatted:!0},e.url=n.buildUrl("/invoices/"+i.id),e.resources.paymentListUrl=e.url+"/payments",e.resources.refundListUrl=e.url+"/refunds",n.getItem(e.url,e.params).then(function(i){e.invoice=i,e.successful_payment=_.findWhere(e.invoice.payments.data,{success:!0})},function(i){e.exception.error=i,window.scrollTo(0,0)}),e.send=function(){n.set(null,e.url+"/send").then(function(i){c.addGrowl({id:"invoice_sent",type:"success",email:e.invoice.customer.email})},function(i){e.exception.error=i,window.scrollTo(0,0)})},e.downloadPdf=function(){n.getItemPdf(e.url).then(function(i){var o=new Blob([i],{type:"application/pdf"});saveAs(o,"Invoice_"+e.invoice.invoice_id+".pdf")},function(i){e.exception.error=i,window.scrollTo(0,0)})},e.changeCurrency=function(){var i={currency:e.invoice.currency};return n.set(i,e.url,e.params).then(function(i){e.invoice=i},function(i){e.exception.error=i,window.scrollTo(0,0)})}}]),app.controller("NotificationsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,i,o,n,r,t){e.exception={},e.resources={},e.resources.notificationListUrl=t.buildUrl("/notifications")}]),app.controller("NotificationsViewCtrl",["$scope","$routeParams","ApiService","GrowlsService","$sce",function(e,i,o,n,r){e.notification={},e.exception={},e.url=o.buildUrl("/notifications/"+i.id),e.previewUrl=null,e.showResend=!1;var t={expand:"customer",hide:"data"};o.getItem(e.url,t).then(function(i){e.notification=i,e.previewUrl=r.trustAsResourceUrl("/app/pages/notifications/preview/index.html?notification_id="+i.notification_id),e.email=i.customer.email},function(i){e.exception.error=i,window.scrollTo(0,0)}),e.resend=function(i){if(!i.$invalid){var r={destination:e.email};o.set(r,e.url+"/resend",{show:"notification_id"}).then(function(i){n.addGrowl({id:"notification_resend",email:e.email,type:"success"}),e.showResend=!1},function(i){e.exception.error=i,window.scrollTo(0,0)})}}}]),app.controller("NotificationsPreviewCtrl",["$scope","$routeParams","ApiService",function(e,i,o){e.notification={},e.exception={},e.url=o.buildUrl("/notifications/"+i.id);var n={show:"body"};o.getItem(e.url,n).then(function(i){e.notification=i},function(i){e.exception.error=i,window.scrollTo(0,0)})}]),app.controller("OrdersListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,i,o,n,r,t){e.exception={},e.resources={},e.resources.orderListUrl=t.buildUrl("/customers/me/orders")}]),app.controller("OrdersViewCtrl",["$scope","$routeParams","ApiService","ConfirmService","GrowlsService",function(e,i,o,n,r){e.order={},e.payment={},e.exception={},e.count={},e.count.shipments=0,e.resources={},e.url=o.buildUrl("/orders/"+i.id),e.resources.shipmentListUrl=e.url+"/shipments",e.resources.refundListUrl=e.url+"/refunds",e.resources.notificationListUrl=e.url+"/notifications";var t={expand:"customer,payment.response_data,payment.payment_method,payment.gateway,payment.refunds,items.product,items.subscription,items.download.file,items.license.license_service,shipments",hide:"items.product.images,items.license.license_service.configuration",formatted:!0};o.getItem(e.url,t).then(function(i){e.order=i,e.showShipping=!1,_.each(e.order.items,function(i){i.license&&(i.license.renderedHtml="<strong>"+i.license.label+"</strong><br>"+i.license.html,i.license.instructions&&(e.renderedLicenseHtml+="<br><br>"+i.license.instructions)),"physical"==i.type&&(e.showShipping=!0)})},function(i){e.exception.error=i,window.scrollTo(0,0)}),e.downloadPdf=function(){o.getItemPdf(e.url).then(function(i){var o=new Blob([i],{type:"application/pdf"});saveAs(o,"Order_"+e.order.order_id+".pdf")},function(i){e.exception.error=i,window.scrollTo(0,0)})}}]),app.controller("CustomersViewCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","GeographiesService",function(e,i,o,n,r,t,c){e.customer={},e.billing_address={},e.shipping_address={},e.resources={},e.edit=!1,e.exception={},e.credentials={},e.url=r.buildUrl("/customers/me"),r.getItem(e.url).then(function(i){e.customer=i,e.credentials.username=i.username,e.payment_methods=i.payment_methods},function(i){e.exception.error=i,window.scrollTo(0,0)}),e.setCredentials=function(){e.exception.error=null,r.set(e.credentials,e.url).then(function(i){e.customer=i,n.addGrowl({id:"credentials_saved",type:"success"}),e.editCredentials=!1},function(i){e.exception.error=i,window.scrollTo(0,0)})}}]),app.controller("SubscriptionsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,i,o,n,r,t){e.exception={},e.resources={},e.resources.subscriptionListUrl=t.buildUrl("/customers/me/subscriptions")}]),app.controller("SubscriptionsViewCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","SettingsService",function(e,i,o,n,r,t,c){e.exception={},e.payment_method=null,e.invoices={},e.model={},e.model.subscription={},e.resources={},e.count={},e.count.invoices=0,e.allowCancel=c.get().account.allow_customer_subscription_cancel,e.url=r.buildUrl("/subscriptions/"+i.id),e.resources.invoiceListUrl=e.url+"/invoices",r.getItem(e.url,{expand:"subscription_plan,customer.payment_methods,item.product",hide:"product.images"}).then(function(i){e.model.subscription=i},function(i){e.exception.error=i,window.scrollTo(0,0)}),e.uncancel=function(){r.set(null,e.url+"/uncancel",{expand:"subscription_plan,customer.cards,product",hide:"product.images"}).then(function(i){e.model.subscription=i},function(i){e.exception.error=i,window.scrollTo(0,0)})}}]),$("document").ready(function(){var e=localStorage.getItem("token"),i="api.comecero.com";window.location.hostname.indexOf("admin-staging.")>-1&&(i="api-staging.comecero.com");var o=utils.getPageQueryParameters(),n="https://"+i+"/api/v1/invoices/"+o.invoice_id+"/links";o.invoice_id&&$.ajax({type:"POST",url:n,beforeSend:function(i){i.setRequestHeader("Authorization","Bearer "+e)},success:function(e){window.location=e.link_url}})}),$("document").ready(function(){var e=localStorage.getItem("token"),i="api.comecero.com";window.location.hostname.indexOf("admin-staging.")>-1&&(i="api-staging.comecero.com");var o=utils.getPageQueryParameters(),n="https://"+i+"/api/v1/notifications/"+o.notification_id+"?show=body";o.notification_id&&$.ajax({type:"GET",url:n,beforeSend:function(i){i.setRequestHeader("Authorization","Bearer "+e)},success:function(e){document.open(),document.write(e.body),document.close()}})});