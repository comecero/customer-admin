app.controller("InvoicesListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,o,n,i,r){e.exception={},e.resources={},e.resources.invoiceListUrl=r.buildUrl("/customers/me/invoices")}]),app.controller("InvoicesSetCtrl",["$scope","$routeParams","$location","ApiService","SettingsService","ConfirmService","GrowlsService",function(e,t,o,n,i,r,s){e.invoice={},e.payment={},e.exception={},e.count={},e.count.payments=0,e.count.refunds=0,e.resources={},e.currencies=i.get().account.currencies,e.params={expand:"customer.payment_methods,options,payments.payment_method,items.subscription_terms,subscription",formatted:!0},e.url=n.buildUrl("/invoices/"+t.id),e.resources.paymentListUrl=e.url+"/payments",e.resources.refundListUrl=e.url+"/refunds",n.getItem(e.url,e.params).then(function(t){e.invoice=t,e.successful_payment=_.findWhere(e.invoice.payments.data,{success:!0})},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.send=function(){n.set(null,e.url+"/send").then(function(t){s.addGrowl({id:"invoice_sent",type:"success",email:e.invoice.customer.email})},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.downloadPdf=function(){n.getItemPdf(e.url).then(function(t){var o=new Blob([t],{type:"application/pdf"});saveAs(o,"Invoice_"+e.invoice.invoice_id+".pdf")},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.changeCurrency=function(){var t={currency:e.invoice.currency};return n.set(t,e.url,e.params).then(function(t){e.invoice=t},function(t){e.exception.error=t,window.scrollTo(0,0)})}}]),app.controller("NotificationsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,o,n,i,r){e.exception={},e.resources={},e.resources.notificationListUrl=r.buildUrl("/notifications")}]),app.controller("NotificationsViewCtrl",["$scope","$routeParams","ApiService","GrowlsService","$sce",function(e,t,o,n,i){e.notification={},e.exception={},e.url=o.buildUrl("/notifications/"+t.id),e.previewUrl=null,e.showResend=!1;var r={expand:"customer",hide:"data"};o.getItem(e.url,r).then(function(t){e.notification=t,e.previewUrl=i.trustAsResourceUrl("/app/pages/notifications/preview/index.html?notification_id="+t.notification_id),e.email=t.customer.email},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.resend=function(t){if(!t.$invalid){var i={destination:e.email};o.set(i,e.url+"/resend",{show:"notification_id"}).then(function(t){n.addGrowl({id:"notification_resend",email:e.email,type:"success"}),e.showResend=!1},function(t){e.exception.error=t,window.scrollTo(0,0)})}}}]),app.controller("NotificationsPreviewCtrl",["$scope","$routeParams","ApiService",function(e,t,o){e.notification={},e.exception={},e.url=o.buildUrl("/notifications/"+t.id);var n={show:"body"};o.getItem(e.url,n).then(function(t){e.notification=t},function(t){e.exception.error=t,window.scrollTo(0,0)})}]),app.controller("OrdersListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,o,n,i,r){e.exception={},e.resources={},e.resources.orderListUrl=r.buildUrl("/customers/me/orders")}]),app.controller("OrdersViewCtrl",["$scope","$routeParams","ApiService","ConfirmService","GrowlsService",function(e,t,o,n,i){e.order={},e.payment={},e.exception={},e.count={},e.count.shipments=0,e.resources={},e.url=o.buildUrl("/orders/"+t.id),e.resources.shipmentListUrl=e.url+"/shipments",e.resources.refundListUrl=e.url+"/refunds",e.resources.notificationListUrl=e.url+"/notifications";var r={expand:"customer,payment.response_data,payment.payment_method,payment.gateway,payment.refunds,items.product,items.subscription,items.download.file,items.license.license_service,shipments",hide:"items.product.images,items.license.license_service.configuration",formatted:!0};o.getItem(e.url,r).then(function(t){e.order=t,e.showShipping=!1,_.each(e.order.items,function(t){t.license&&(t.license.renderedHtml="<strong>"+t.license.label+"</strong><br>"+t.license.html,t.license.instructions&&(e.renderedLicenseHtml+="<br><br>"+t.license.instructions)),"physical"==t.type&&(e.showShipping=!0)})},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.downloadPdf=function(){o.getItemPdf(e.url).then(function(t){var o=new Blob([t],{type:"application/pdf"});saveAs(o,"Order_"+e.order.order_id+".pdf")},function(t){e.exception.error=t,window.scrollTo(0,0)})}}]),app.controller("PaymentMethodsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,o,n,i,r){e.exception={},e.resources={},e.resources.paymentMethodListUrl=r.buildUrl("/customers/me/payment_methods")}]),app.controller("PaymentMethodsSetCtrl",["$scope","$routeParams","$location","ApiService","SettingsService","ConfirmService","GrowlsService","GeographiesService",function(e,t,o,n,i,r,s,c){e.paymentMethod={data:{billing_address:{}}},e.countries={},e.exception={},e.update=!1,e.add=!0,e.params="",e.geo=c,e.countries=e.geo.getGeographies().countries,e.us_states=e.geo.getGeographies().us_states,e.ca_provinces=e.geo.getGeographies().ca_provinces,e.au_states=e.geo.getGeographies().au_states,e.countries.push({code:"EU",name:"European Union"}),e.countries=_.sortBy(e.countries,"name"),t.id&&(e.url=n.buildUrl("/customers/me/payment_methods/"+t.id),e.add=!1,e.update=!0,n.getItem(e.url,e.params).then(function(t){var o=_.find(e.countries,function(e){return e.code==t.data.billing_address.country});e.onCountrySelect(o);var n=_.find(e.states,function(e){return e.code==t.data.billing_address.state_prov});t.data.billing_address.country=o,t.data.billing_address.state_prov=n,e.paymentMethod=t},function(t){e.exception.error=t,window.scrollTo(0,0)})),e.onCountrySelect=function(t,o,n,i){"US"===t.code?e.states=e.us_states:"CA"===t.code?e.states=e.ca_provinces:"AU"===t.code?e.states=e.au_states:(e.paymentMethod.data.billing_address.state_prov="",e.states=null)},e.addPaymentMethod=function(){return e.form.$invalid?void window.scrollTo(0,0):(e.paymentMethod.type="credit_card",e.paymentMethod.data.billing_address.country=e.paymentMethod.data.billing_address.country.code,e.paymentMethod.data.billing_address.state_prov&&(e.paymentMethod.data.billing_address.state_prov=e.paymentMethod.data.billing_address.state_prov.code),void n.set(e.paymentMethod,n.buildUrl("/customers/me/payment_methods"),{show:"payment_method_id"}).then(function(e){s.addGrowl({id:"add_success",name:e.payment_method_id,type:"success",payment_method_id:e.payment_method_id,url:"#/payment_methods/"+e.payment_method_id+"/edit"}),window.location="#/payment_methods"},function(t){e.exception.error=t,window.scrollTo(0,0)}))},e.updatePaymentMethod=function(){return e.form.$invalid?void window.scrollTo(0,0):(e.paymentMethod.data.billing_address.country=e.paymentMethod.data.billing_address.country.code,e.paymentMethod.data.billing_address.state_prov&&(e.paymentMethod.data.billing_address.state_prov=e.paymentMethod.data.billing_address.state_prov.code),void n.set(e.paymentMethod,e.url,{show:"payment_method_id"}).then(function(e){s.addGrowl({id:"edit_success",name:e.payment_method_id,type:"success",payment_method_id:e.payment_method_id,url:"#/payment_methods/"+e.payment_method_id+"/edit"}),window.location="#/payment_methods"},function(t){window.scrollTo(0,0),e.exception.error=t}))},e.confirmCancel=function(){var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(o,"/payment_methods")},r.showConfirm(e,t)},e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.removePaymentMethod()},r.showConfirm(e,t)},e.removePaymentMethod=function(){n.remove(e.paymentMethod.url).then(function(t){s.addGrowl({id:"delete_success",name:e.paymentMethod.payment_method_id,type:"success"}),utils.redirect(o,"/payment_methods")},function(t){window.scrollTo(0,0),e.exception.error=t})}}]),app.controller("CustomersViewCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","GeographiesService",function(e,t,o,n,i,r,s){e.customer={},e.billing_address={},e.shipping_address={},e.resources={},e.edit=!1,e.exception={},e.credentials={},e.url=i.buildUrl("/customers/me"),i.getItem(e.url).then(function(t){e.customer=t,e.credentials.username=t.username,e.payment_methods=t.payment_methods},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.setCredentials=function(){e.exception.error=null,i.set(e.credentials,e.url).then(function(t){e.customer=t,n.addGrowl({id:"credentials_saved",type:"success"}),e.editCredentials=!1},function(t){e.exception.error=t,window.scrollTo(0,0)})}}]),app.controller("SubscriptionsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,o,n,i,r){e.exception={},e.resources={},e.resources.subscriptionListUrl=r.buildUrl("/customers/me/subscriptions")}]),app.controller("SubscriptionsViewCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","SettingsService",function(e,t,o,n,i,r,s){e.exception={},e.payment_method=null,e.invoices={},e.model={},e.model.subscription={},e.resources={},e.count={},e.count.invoices=0,e.allowCancel=s.get().account.allow_customer_subscription_cancel,e.url=i.buildUrl("/subscriptions/"+t.id),e.resources.invoiceListUrl=e.url+"/invoices",i.getItem(e.url,{expand:"subscription_plan,customer.payment_methods,item.product",hide:"product.images"}).then(function(t){e.model.subscription=t},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.uncancel=function(){i.set(null,e.url+"/uncancel",{expand:"subscription_plan,customer.cards,product",hide:"product.images"}).then(function(t){e.model.subscription=t},function(t){e.exception.error=t,window.scrollTo(0,0)})}}]),$("document").ready(function(){var e=localStorage.getItem("token"),t="api.comecero.com";window.location.hostname.indexOf("admin-staging.")>-1&&(t="api-staging.comecero.com");var o=utils.getPageQueryParameters(),n="https://"+t+"/api/v1/invoices/"+o.invoice_id+"/links";o.invoice_id&&$.ajax({type:"POST",url:n,beforeSend:function(t){t.setRequestHeader("Authorization","Bearer "+e)},success:function(e){window.location=e.link_url}})}),$("document").ready(function(){var e=localStorage.getItem("token"),t="api.comecero.com";window.location.hostname.indexOf("admin-staging.")>-1&&(t="api-staging.comecero.com");var o=utils.getPageQueryParameters(),n="https://"+t+"/api/v1/notifications/"+o.notification_id+"?show=body";o.notification_id&&$.ajax({type:"GET",url:n,beforeSend:function(t){t.setRequestHeader("Authorization","Bearer "+e)},success:function(e){document.open(),document.write(e.body),document.close()}})});