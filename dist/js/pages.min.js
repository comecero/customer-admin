app.controller("GettingStartedCtrl",["$scope","SettingsService",function(e,t){var o=t.get();e.helpUrl=o.account.support_website||"mailto:"+o.account.support_email}]),app.controller("InvoicesListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService","SettingsService",function(e,t,o,i,n,r,c){e.exception={},e.resources={},e.resources.invoiceListUrl=r.buildUrl("/customers/me/invoices",c.get())}]),app.controller("InvoicesSetCtrl",["$scope","$routeParams","$location","ApiService","SettingsService","ConfirmService","GrowlsService",function(e,t,o,i,n,r,c){e.invoice={},e.payment={},e.exception={},e.count={},e.count.payments=0,e.count.refunds=0,e.resources={},e.currencies=n.get().account.currencies,e.params={expand:"customer.payment_methods,options,payments.payment_method,items.subscription_terms,subscription",formatted:!0},e.url=i.buildUrl("/invoices/"+t.id,n.get()),e.resources.paymentListUrl=e.url+"/payments",e.resources.refundListUrl=e.url+"/refunds",i.getItem(e.url,e.params).then(function(t){e.invoice=t,e.successful_payment=_.findWhere(e.invoice.payments.data,{success:!0})},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.send=function(){i.set(null,e.url+"/send").then(function(t){c.addGrowl({id:"invoice_sent",type:"success",email:e.invoice.customer.email})},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.downloadPdf=function(){i.getItemPdf(e.url).then(function(t){var o=new Blob([t],{type:"application/pdf"});saveAs(o,"Invoice_"+e.invoice.invoice_id+".pdf")},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.changeCurrency=function(){var t={currency:e.invoice.currency};return i.set(t,e.url,e.params).then(function(t){e.invoice=t},function(t){e.exception.error=t,window.scrollTo(0,0)})}}]),app.controller("NotificationsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,o,i,n,r){e.exception={},e.resources={},e.resources.notificationListUrl=r.buildUrl("/notifications")}]),app.controller("NotificationsViewCtrl",["$scope","$routeParams","ApiService","GrowlsService","$sce","SettingsService",function(e,t,o,i,n,r){e.notification={},e.exception={},e.url=o.buildUrl("/notifications/"+t.id,r.get()),e.previewUrl=null,e.showResend=!1;var c={expand:"customer",hide:"data"};o.getItem(e.url,c).then(function(t){e.notification=t,e.previewUrl=n.trustAsResourceUrl("app/pages/notifications/preview/index.html?notification_id="+t.notification_id),e.email=t.customer.email},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.resend=function(t){if(!t.$invalid){var n={destination:e.email};o.set(n,e.url+"/resend",{show:"notification_id"}).then(function(t){i.addGrowl({id:"notification_resend",email:e.email,type:"success"}),e.showResend=!1},function(t){e.exception.error=t,window.scrollTo(0,0)})}}}]),app.controller("NotificationsPreviewCtrl",["$scope","$routeParams","ApiService","SettingsService",function(e,t,o,i){e.notification={},e.exception={},e.url=o.buildUrl("/notifications/"+t.id,i.get());var n={show:"body"};o.getItem(e.url,n).then(function(t){e.notification=t},function(t){e.exception.error=t,window.scrollTo(0,0)})}]),app.controller("OrdersListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService","SettingsService",function(e,t,o,i,n,r,c){e.exception={},e.resources={},e.resources.orderListUrl=r.buildUrl("/customers/me/orders",c.get()),e.functions={},e.functions.toItemCsv=function(e){if(e&&e.items){var t=_.pluck(e.items,"name"),o=t.join(", ");return o}}}]),app.controller("OrdersViewCtrl",["$scope","$routeParams","ApiService","ConfirmService","GrowlsService","SettingsService",function(e,t,o,i,n,r){e.order={},e.payment={},e.exception={},e.count={},e.count.shipments=0,e.resources={},e.url=o.buildUrl("/orders/"+t.id,r.get()),e.resources.shipmentListUrl=e.url+"/shipments",e.resources.refundListUrl=e.url+"/refunds",e.resources.notificationListUrl=e.url+"/notifications";var c={expand:"customer,payment.response_data,payment.payment_method,payment.gateway,payment.refunds,items.product,items.subscription,items.subscription_terms,items.download.file,items.license.license_service,shipments",hide:"items.product.images,items.license.license_service.configuration",formatted:!0};o.getItem(e.url,c).then(function(t){e.order=t,e.showShipping=!1,_.each(e.order.items,function(t){t.license&&(t.license.renderedHtml="<strong>"+t.license.label+"</strong><br>"+t.license.html,t.license.instructions&&(e.renderedLicenseHtml+="<br><br>"+t.license.instructions)),"physical"==t.type&&(e.showShipping=!0)})},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.downloadPdf=function(){o.getItemPdf(e.url).then(function(t){var o=new Blob([t],{type:"application/pdf"});saveAs(o,"Order_"+e.order.order_id+".pdf")},function(t){e.exception.error=t,window.scrollTo(0,0)})}}]),app.controller("PaymentMethodsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService","SettingsService",function(e,t,o,i,n,r,c){e.exception={},e.resources={},e.resources.paymentMethodListUrl=r.buildUrl("/customers/me/payment_methods",c.get()),e.functions={},e.functions.getPaymentImageName=function(e){if(e)return"credit_card"==e.type?(e.data.type.toLowerCase()+".png").replace(" ","_"):(e.type.toLowerCase()+".png").replace(" ","_")}}]),app.controller("PaymentMethodsSetCtrl",["$scope","$routeParams","$location","ApiService","SettingsService","ConfirmService","GrowlsService","GeographiesService",function(e,t,o,i,n,r,c,s){e.paymentMethod={data:{billing_address:{}}},e.countries={},e.exception={},e.update=!1,e.add=!0,e.params="",e.geo=s,e.countries=e.geo.getGeographies().countries,e.us_states=e.geo.getGeographies().us_states,e.ca_provinces=e.geo.getGeographies().ca_provinces,e.au_states=e.geo.getGeographies().au_states,e.countries=_.sortBy(e.countries,"name"),t.id?(e.url=i.buildUrl("/customers/me/payment_methods/"+t.id,n.get()),e.add=!1,e.update=!0,i.getItem(e.url,e.params).then(function(t){e.paymentMethod=t},function(t){e.exception.error=t,window.scrollTo(0,0)})):(e.add=!0,e.update=!1),e.addPaymentMethod=function(){return e.form.$invalid?void window.scrollTo(0,0):(e.paymentMethod.type="credit_card",void i.set(e.paymentMethod,i.buildUrl("/customers/me/payment_methods",n.get())).then(function(e){c.addGrowl({id:"add_success",name:e.data.label||data.type,type:"success",payment_method_id:e.payment_method_id,url:"#/payment_methods/"+e.payment_method_id+"/edit"}),utils.redirect(o,"/payment_methods")},function(t){e.exception.error=t,window.scrollTo(0,0)}))},e.updatePaymentMethod=function(){return e.exception.error=null,e.form.$invalid?void window.scrollTo(0,0):void i.set(e.paymentMethod,e.url).then(function(e){c.addGrowl({id:"edit_success",name:e.data.label||e.type,type:"success",payment_method_id:e.payment_method_id,url:"#/payment_methods/"+e.payment_method_id+"/edit"}),utils.redirect(o,"/payment_methods")},function(t){window.scrollTo(0,0),e.exception.error=t})},e.confirmCancel=function(){var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(o,"/payment_methods")},r.showConfirm(e,t)},e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.removePaymentMethod()},r.showConfirm(e,t)},e.removePaymentMethod=function(){i.remove(e.paymentMethod.url).then(function(t){c.addGrowl({id:"delete_success",name:e.paymentMethod.data.label||e.paymentMethod.type,type:"success"}),utils.redirect(o,"/payment_methods")},function(t){window.scrollTo(0,0),e.exception.error=t})},e.getPaymentImageName=function(e){if(e)return"credit_card"==e.type?(e.data.type.toLowerCase()+".png").replace(" ","_"):(e.type.toLowerCase()+".png").replace(" ","_")}}]),app.controller("CustomersViewCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","GeographiesService","SettingsService",function(e,t,o,i,n,r,c,s){e.customer={},e.billing_address={},e.shipping_address={},e.resources={},e.edit=!1,e.exception={},e.credentials={},e.url=n.buildUrl("/customers/me",s.get()),n.getItem(e.url).then(function(t){e.customer=t,e.credentials.username=t.username,e.payment_methods=t.payment_methods},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.setCredentials=function(){e.exception.error=null,n.set(e.credentials,e.url).then(function(t){e.customer=t,i.addGrowl({id:"credentials_saved",type:"success"}),e.editCredentials=!1},function(t){e.exception.error=t,window.scrollTo(0,0)})}}]),app.controller("SubscriptionsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService","SettingsService",function(e,t,o,i,n,r,c){e.exception={},e.resources={},e.resources.subscriptionListUrl=r.buildUrl("/customers/me/subscriptions",c.get())}]),app.controller("SubscriptionsViewCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","SettingsService",function(e,t,o,i,n,r,c){e.exception={},e.payment_method=null,e.invoices={},e.model={},e.model.subscription={},e.resources={},e.count={},e.count.invoices=0,e.allowCancel=c.get().account.allow_customer_subscription_cancel,e.url=n.buildUrl("/subscriptions/"+t.id,c.get()),e.resources.invoiceListUrl=e.url+"/invoices",n.getItem(e.url,{expand:"items.subscription_terms,customer.payment_methods",hide:"product.images",formatted:!0}).then(function(t){e.model.subscription=t},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.uncancel=function(){n.set(null,e.url+"/uncancel",{expand:"subscription_plan,customer.cards,product",hide:"product.images"}).then(function(t){e.model.subscription=t},function(t){e.exception.error=t,window.scrollTo(0,0)})}}]),$("document").ready(function(){var e=localStorage.getItem("token"),t="api.comecero.com";window.location.hostname.indexOf("-staging.")>-1&&(t="api-staging.comecero.com");var o=utils.getPageQueryParameters(),i="https://"+t+"/api/v1/invoices/"+o.invoice_id+"/links";o.invoice_id&&$.ajax({type:"POST",url:i,beforeSend:function(t){t.setRequestHeader("Authorization","Bearer "+e)},success:function(e){window.location=e.link_url}})}),$("document").ready(function(){var e=localStorage.getItem("token"),t="api.comecero.com";window.location.hostname.indexOf("-staging.")>-1&&(t="api-staging.comecero.com");var o=utils.getPageQueryParameters(),i="https://"+t+"/api/v1/notifications/"+o.notification_id+"?show=body";o.notification_id&&$.ajax({type:"GET",url:i,beforeSend:function(t){t.setRequestHeader("Authorization","Bearer "+e)},success:function(e){document.open(),document.write(e.body),document.close()}})});